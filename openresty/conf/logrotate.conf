# Nginx日志轮转配置
# 主访问日志 - 保留7天
/usr/local/openresty/nginx/logs/access.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 644 nobody nobody
    postrotate
        /usr/bin/docker exec dify-openresty-loadbalancer /usr/local/openresty/bin/openresty -s reopen
    endscript
}

# 应用路由日志 - 保留30天
/usr/local/openresty/nginx/logs/app_routing.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 nobody nobody
    postrotate
        /usr/bin/docker exec dify-openresty-loadbalancer /usr/local/openresty/bin/openresty -s reopen
    endscript
}

# 安全审计日志 - 保留90天
/usr/local/openresty/nginx/logs/security_audit.log {
    daily
    rotate 90
    compress
    delaycompress
    missingok
    notifempty
    create 644 nobody nobody
    postrotate
        /usr/bin/docker exec dify-openresty-loadbalancer /usr/local/openresty/bin/openresty -s reopen
    endscript
}

# 性能监控日志 - 保留14天
/usr/local/openresty/nginx/logs/performance.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 644 nobody nobody
    postrotate
        /usr/bin/docker exec dify-openresty-loadbalancer /usr/local/openresty/bin/openresty -s reopen
    endscript
}

# 错误日志 - 保留30天
/usr/local/openresty/nginx/logs/error.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 nobody nobody
    postrotate
        /usr/bin/docker exec dify-openresty-loadbalancer /usr/local/openresty/bin/openresty -s reopen
    endscript
}

# 详细错误日志 - 保留14天
/usr/local/openresty/nginx/logs/error_detail.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 644 nobody nobody
    postrotate
        /usr/bin/docker exec dify-openresty-loadbalancer /usr/local/openresty/bin/openresty -s reopen
    endscript
}